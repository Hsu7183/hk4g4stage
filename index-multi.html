<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>三劍客台指期策略分析（批量版）</title>

  <link rel="stylesheet" href="style.css" />

  <style>
    :root{
      --bg:#f5f6f8; --card:#fff; --border:#e5e7eb; --text:#111827;
      --muted:#6b7280; --primary:#2563eb;
      --shadow: 0 8px 20px rgba(0,0,0,.06);
    }
    html,body{background:var(--bg); color:var(--text)}
    header, .toolbar, .sub, .table-wrap, #topSplit, #topKPI { max-width:100%; margin:1rem auto; padding:0 1rem; }

    header{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
    h1{margin:0;font-size:1.45rem;letter-spacing:.02em}
    .btn-group{display:flex;gap:.6rem}
    .btn{display:inline-flex;align-items:center;padding:.55rem 1.05rem;border:1px solid var(--border);
      border-radius:.6rem;background:#fff;cursor:pointer;box-shadow:var(--shadow)}
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
    .btn.primary:hover{filter:brightness(1.05)}
    .btn:hover{transform:translateY(-1px)}

    #topSplit{display:grid; grid-template-columns:1fr 1fr; gap:1rem; align-items:start}
    .card{background:var(--card);border:1px solid var(--border);border-radius:.8rem;padding:.7rem;box-shadow:var(--shadow)}
    #chartBox{height:390px}
    #tradesBox{height:390px;overflow:auto}
    #tradesBox table{width:100%;border-collapse:collapse;font-size:.88rem}
    #tradesBox th,#tradesBox td{border-bottom:1px solid var(--border);padding:.45rem .35rem;text-align:center}
    #tradesBox thead th{position:sticky;top:0;background:#fafafa;z-index:1}
    #tradesBox tbody tr:nth-child(4n+1), #tradesBox tbody tr:nth-child(4n+2){background:#fcfcfd}

    #topKPI.card{padding:1rem}
    .kpi-block{margin:.5rem 0 .8rem}
    .kpi-title{font-weight:800;margin:.2rem 0 .5rem}
    .kpi-line{display:flex;flex-wrap:wrap;gap:1rem .9rem}
    .kpi-item{white-space:nowrap;font-size:.95rem}
    .kpi-key{color:#374151}
    .kpi-val{font-weight:700}

    .toolbar{display:flex;gap:.8rem;align-items:center;flex-wrap:wrap}
    .hint{color:var(--muted);font-size:.9rem}
    .stats{color:#374151;font-size:.9rem}

    .table-wrap .card{padding:0}
    table#tblBatch{width:100%;border-collapse:collapse;font-size:.9rem}
    #tblBatch th,#tblBatch td{padding:.55rem .4rem;border-bottom:1px solid var(--border);text-align:center}
    #tblBatch thead th{background:#fafafa;font-weight:700;position:sticky;top:0;z-index:2}
    #tblBatch tbody tr:nth-child(even){background:#fbfbfd}
    #tblBatch tbody tr:hover{background:#eef2ff}
    th.sortable{cursor:pointer;position:relative;user-select:none}
    th.sortable::after{content:"⇅";font-size:.8rem;color:#9ca3af;position:absolute;right:.35rem;top:50%;transform:translateY(-50%)}
    th.sortable.asc::after{content:"↑"} th.sortable.desc::after{content:"↓"}
    table.sticky th:first-child, table.sticky td:first-child{position:sticky;left:0;background:#fff;z-index:1}
    table.sticky thead th:first-child{z-index:3;background:#fafafa}
    .nowrap{white-space:nowrap}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header>
    <h1>三劍客台指期策略分析（批量版）</h1>
    <div class="btn-group">
      <label class="btn primary">選擇多個檔案
        <input type="file" id="filesInput" accept=".txt,.TF" multiple hidden />
      </label>
      <button id="btn-clear" class="btn">清空結果</button>
    </div>
  </header>

  <div id="topSplit">
    <div class="card" id="chartBox">
      <h2 class="sub" style="margin:.2rem 0 .6rem">第一列收益曲線</h2>
      <canvas id="equityChart"></canvas>
    </div>
    <div class="card" id="tradesBox">
      <h2 class="sub" style="margin:.2rem 0 .6rem">第一列交易紀錄</h2>
      <table>
        <thead>
          <tr>
            <th>筆數</th><th>時間</th><th>價格</th><th>類型</th>
            <th>點數</th><th>手續費</th><th>期交稅</th>
            <th>獲利</th><th>累積獲利</th>
            <th>滑價獲利</th><th>累積滑價獲利</th>
          </tr>
        </thead>
        <tbody id="tradesBody"><tr><td colspan="11" style="color:#777">尚未載入</td></tr></tbody>
      </table>
    </div>
  </div>

  <div class="card" id="topKPI">
    <h2 class="sub" style="margin:.2rem 0 .6rem">第一列數值彙整（全部 / 多單 / 空單）</h2>
    <div id="kpiBlocks"></div>
  </div>

  <div class="toolbar">
    <div class="hint">一次可選最多約 1,000 筆；下表的「參數」欄目前**取自檔名**（前三段為短檔名，其餘為參數）。任一欄可排序；排序後，上方改為第一列資料。</div>
    <div class="stats" id="loadStat"></div>
  </div>

  <div class="table-wrap">
    <div class="card">
      <h2 class="sub" style="margin:1rem">彙總結果</h2>
      <table id="tblBatch" class="sticky">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script type="module" src="app-multi.js?v=2025-08-10f"></script>
</body>
</html>
