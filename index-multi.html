<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>三劍客台指期策略分析（批量版）</title>

  <link rel="stylesheet" href="style.css" />

  <style>
    /* 全寬 */
    body.wide header,
    body.wide .toolbar,
    body.wide .sub,
    body.wide .table-wrap,
    body.wide #topSplit,
    body.wide #topKPI { max-width:100%; margin:1rem auto; padding:0 1rem; }

    .toolbar{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
    .hint{color:#666;font-size:.86rem}
    .stats{color:#555;font-size:.86rem}

    /* 上方左右各半（圖 / 交易明細） */
    #topSplit{display:grid;grid-template-columns:1fr 1fr;gap:1rem;align-items:start}
    #chartBox{
      width:100%; height:360px; background:#fff; border:1px solid var(--border);
      border-radius:.5rem; padding:.6rem; box-sizing:border-box;
    }
    #tradesBox{
      height:360px; background:#fff; border:1px solid var(--border);
      border-radius:.5rem; padding:.6rem; box-sizing:border-box; overflow:auto;
    }
    #tradesBox table{width:100%; border-collapse:collapse; font-size:.84rem}
    #tradesBox th,#tradesBox td{border-bottom:1px solid var(--border); padding:.35rem .3rem; text-align:center}
    #tradesBox thead th{position:sticky; top:0; background:#fafafa; z-index:1}

    /* 第一列 KPI 區塊 */
    #topKPI{background:#fff;border:1px solid var(--border);border-radius:.5rem;padding:.8rem}
    .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.6rem .8rem}
    .kpi-card{border:1px solid var(--border);border-radius:.5rem;padding:.6rem .7rem}
    .kpi-card h3{margin:.1rem 0 .4rem;font-size:.95rem;border-bottom:1px solid var(--border);padding-bottom:.3rem}
    .kpi-item{white-space:nowrap;font-size:.86rem}
    .kpi-key{color:#555}
    .kpi-val{font-weight:600}

    /* 下方表格：表頭排序、第一欄固定 */
    th.sortable{cursor:pointer; position:relative; user-select:none;}
    th.sortable::after{content:"⇅"; font-size:.8rem; color:#999; position:absolute; right:.35rem; top:50%; transform:translateY(-50%);}
    th.sortable.asc::after{content:"↑";}
    th.sortable.desc::after{content:"↓";}
    table.sticky th:first-child, table.sticky td:first-child { position: sticky; left: 0; background: #fff; z-index: 1; }
    table.sticky thead th:first-child { z-index: 2; background:#fafafa; }
    .nowrap{white-space:nowrap}
  </style>

  <!-- 只用 Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="wide">
  <header>
    <h1>三劍客台指期策略分析（批量版）</h1>
    <div class="btn-group">
      <label class="btn primary">選擇多個檔案
        <input type="file" id="filesInput" accept=".txt,.TF" multiple hidden />
      </label>
      <button id="btn-clear" class="btn">清空結果</button>
    </div>
  </header>

  <!-- 上半：左圖右表 -->
  <div id="topSplit">
    <div>
      <h2 class="sub" style="margin-top:0.2rem">第一列收益曲線</h2>
      <div id="chartBox"><canvas id="equityChart"></canvas></div>
    </div>
    <div>
      <h2 class="sub" style="margin-top:0.2rem">第一列交易紀錄</h2>
      <div id="tradesBox">
        <table>
          <thead>
            <tr>
              <th>#</th><th>進場時間</th><th>進場價</th><th>方向</th>
              <th>出場時間</th><th>出場價</th><th>點數</th><th>手續費</th>
              <th>稅</th><th>獲利</th><th>滑價獲利</th>
            </tr>
          </thead>
          <tbody id="tradesBody"><tr><td colspan="11" style="color:#777">尚未載入</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 第一列 KPI -->
  <div id="topKPI">
    <h2 class="sub" style="margin:.2rem 0 .6rem">第一列數值彙整（全部 / 多單 / 空單）</h2>
    <div class="kpi-grid" id="kpiGrid"></div>
  </div>

  <div class="toolbar">
    <div class="hint">一次可選最多約 1,000 筆 TXT；每列：短檔名 + 參數 + <b>全部 / 多單 / 空單</b> 全部 KPI。點欄位可排序（排序後，上方改為第一列資料）。</div>
    <div class="stats" id="loadStat"></div>
  </div>

  <h2 class="sub">彙總結果</h2>
  <div class="table-wrap" style="overflow:auto;">
    <table id="tblBatch" class="sticky">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <script type="module" src="app-multi.js?v=2025-08-10c"></script>
</body>
</html>
